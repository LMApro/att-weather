angular.module("attWeather",["ngRoute"]).provider("Weather",function(){this.setApiKey=function(a){a&&(this.apiKey=a)};this.$get=function(a,b){var d=this;return{getWeatherForecast:function(c){var e=a.defer();b({method:"GET",url:d.getUrl("forecast",c),cache:!0}).success(function(a){e.resolve(a.forecast.simpleforecast)}).error(function(a){e.reject(a)});return e.promise},getCityDetails:function(c){var d=a.defer();b({method:"GET",url:"http://autocomplete.wunderground.com/aq?query="+c}).success(function(a){d.resolve(a.RESULTS)}).error(function(a){d.reject(a)});
return d.promise}}};this.getUrl=function(a,b){return"http://api.wunderground.com/api/"+this.apiKey+"/"+a+"/q/"+b+".json"}}).config(["$routeProvider",function(a){a.when("/",{templateUrl:"templates/home.html",controller:"MainCtrl"}).when("/settings",{templateUrl:"templates/settings.html",controller:"SettingsCtrl"}).otherwise({redirectTo:"/"})}]).config(["WeatherProvider",function(a){a.setApiKey("7849e2a87a30dcc7")}]).controller("MainCtrl",["$scope","$timeout","Weather","UserService",function(a,b,d,
c){a.user=c.user;a.date={};var e=function(){a.date.raw=new Date;b(e,1E3)};e();a.weather={};d.getWeatherForecast(a.user.location).then(function(b){a.weather.forecast=b})}]).controller("SettingsCtrl",["$scope","$location","UserService","Weather",function(a,b,d,c){a.user=d.user;a.save=function(){d.save();b.url("/")};a.setAuto=function(){a.user.location="autoip"};a.fetchCities=c.getCityDetails}]).directive("autofill",function(a){return{restrict:"EA",scope:{autoFill:"&",ngModel:"="},compile:function(b,
d){var c=angular.element('<div class="typeahead"><input type="text" autocomplete="off" /><ul id="autolist" ng-show="reslist"><li ng-repeat="res in reslist" >{{res.name}}</li></ul></div>'),e=c.find("input");e.attr("type",d.type);e.attr("ng-model",d.ngModel);e.attr("timezone",d.timezone);b.replaceWith(c);return function(b,d,c,e){var h=c.minKeyCount||3,g;c=d.find("input");c.bind("keyup",function(c){val=d.val();val.length<h?(g&&a.cancel(g),b.reslist=null):(g&&a.cancel(g),g=a(function(){b.autofill()(val).then(function(a){a&&
0<a.length&&(b.reslist=a,b.ngModel=a[0].zmw,b.timezone=a[0].tz)})},300))});c.bind("blur",function(a){b.reslist=null;b.$digest()})}}}}).factory("DatetimeService",function(){return{vnDateName:"Ch\u1ee7 Nh\u1eadt;Th\u1ee9 hai;Th\u1ee9 ba;Th\u1ee9 t\u01b0;Th\u1ee9 n\u0103m;Th\u1ee9 s\u00e1u;Th\u1ee9 b\u1ea3y".split(";"),engDateName:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),engMonthName:"January February March April May June July August September October November December".split(" ")}}).factory("UserService",
function(){var a={location:"autoip"},b={user:{},save:function(){sessionStorage.attweather=angular.toJson(b.user)},restore:function(){b.user=angular.fromJson(sessionStorage.attweather)||a;return b.user}};b.restore();return b}).filter("dayname",function(a){return function(b){for(var d=a.vnDateName,c=0;6>=c;c++)if(b==a.engDateName[c])return d[c]}}).filter("dateVn",function(a){return function(b){b=b.split(", ");for(var d=b[0],c=b[1],e=b[2],f=0;6>=f;f++)if(d===a.engDateName[f]){d=a.vnDateName[f];break}for(f=
0;6>=f;f++)if(c===a.engMonthName[f]){c=" th\u00e1ng "+(f+1);break}return d+", ng\u00e0y "+e+c+", "+b[3]}});